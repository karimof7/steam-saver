<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Steam Saver â€” Mini Tool</title>
<!-- Meta info and Favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<meta name="description" content="Steam Saver â€” simple mini tool for checking free or cheap Steam games via Steam API. Find discounted or free games easily!">
<meta property="og:title" content="Steam Saver â€” Mini Tool">
<meta property="og:description" content="Check Steam games for discounts and free deals quickly!">
<meta property="og:url" content="https://karimof7.github.io/steam-saver/">
<meta property="og:type" content="website">
<meta name="theme-color" content="#121212">
  <style>
    :root{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;--bg:#0f2633;--card:#122936;--muted:#9fb1bd;--accent:#1db954}
    body{margin:0;background:linear-gradient(180deg,#071721 0%, #0b2b36 100%);color:#e6f6f7;padding:18px}
    .wrap{max-width:980px;margin:8px auto}
    header{display:flex;align-items:center;gap:12px}
    h1{margin:0;font-size:20px}
    p.lead{margin:6px 0 18px;color:var(--muted)}
    textarea{width:100%;min-height:80px;background:var(--card);border:1px solid rgba(255,255,255,0.03);color:inherit;padding:10px;border-radius:8px}
    .controls{display:flex;gap:8px;margin-top:8px}
    button{background:var(--accent);border:none;color:#012;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-top:18px}
    .card{background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
    .price{font-weight:700}
    .muted{color:var(--muted);font-size:13px}
    .ok{color:#7ee787}
    .bad{color:#ff7b7b}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    .bolt{font-weight:700;color:var(--accent)}
    pre{background:#071a1f;padding:8px;border-radius:6px;overflow:auto}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Steam Saver â€” Mini tool</h1>
        <p class="lead">Kichik demo: Steam store appdetails API orqali o'yin narxini tekshiradi. <span class="bolt">Paste Steam URLs yoki appIDs</span>, "Check" bos.</p>
      </div>
    </header>

    <label>Steam appIDs yoki to'liq Steam store URL'larini satrga kiriting (har biri yangi qatorda):</label>
    <textarea id="input" placeholder="https://store.steampowered.com/app/578080/PlayerName/\n570\n730"></textarea>
    <div class="controls">
      <button id="check">Check</button>
      <button id="sample" class="ghost">Load sample (demo)</button>
      <button id="clear" class="ghost">Clear</button>
    </div>

    <div id="result" class="grid" aria-live="polite"></div>

    <section style="margin-top:18px">
      <div class="card">
        <h3 style="margin:0 0 8px 0">Qanday ishlaydi (qisqacha)</h3>
        <ol class="muted">
          <li>Har bir appID uchun <code>https://store.steampowered.com/api/appdetails?appids=APPID&cc=us&l=en</code> so'rovi yuboriladi.</li>
          <li>Natijada <strong>is_free</strong>, <strong>price_overview</strong> va kategoriyalar olinadi.</li>
          <li>Agar <em>is_free</em> true bo'lsa yoki narx juda arzon bo'lsa, cardda "ðŸ”¥ Cheap/Free" belgilanadi.</li>
        </ol>
        <p class="muted">Bu mini demo â€” keyin trading-card event, wishlist-sale notifier yoki Telegram botga kengaytirish mumkin.</p>
      </div>
    </section>

    <footer>
      <div>Keyingi qadamlar: 1) Discord/Telegram bot, 2) avtomatik cron/hosting (Replit/GH Actions), 3) Steam jamoasiga post + artwork. Xohlasang bularning hammasini birma-bir sozlab beraman.</div>
    </footer>
  </div>

<script>
  const elInput = document.getElementById('input');
  const elResult = document.getElementById('result');
  const btn = document.getElementById('check');
  const sample = document.getElementById('sample');
  const clear = document.getElementById('clear');

  sample.addEventListener('click', ()=>{
    elInput.value = '578080\n570\n730';
  });
  clear.addEventListener('click', ()=>{elInput.value='';elResult.innerHTML='';});

  btn.addEventListener('click', async ()=>{
    elResult.innerHTML = '';
    const raw = elInput.value.trim();
    if(!raw) return alert('AppID yoki URL kiriting.');
    const lines = raw.split(/\n+/).map(s=>s.trim()).filter(Boolean);
    const appids = lines.map(parseAppId).filter(Boolean);
    if(appids.length===0){alert('Hech qanday appID topilmadi. Iltimos URL yoki raqam kiriting.');return}

    for(const id of appids){
      const card = document.createElement('div'); card.className='card'; card.innerHTML = '<div class="muted">Loading '+id+'â€¦</div>';
      elResult.appendChild(card);
      try{
        const res = await fetch('https://store.steampowered.com/api/appdetails?appids='+encodeURIComponent(id)+'&cc=us&l=en');
        if(!res.ok) throw new Error('Network');
        const json = await res.json();
        if(!json[id] || !json[id].success){
          card.innerHTML = '<div class="muted">App '+id+' not found or API blocked.</div>';
          continue;
        }
        const data = json[id].data;
        const title = data.name || ('App '+id);
        const is_free = !!data.is_free;
        const price = data.price_overview ? (data.price_overview.final/100).toFixed(2) : null;
        const currency = data.price_overview ? data.price_overview.currency : '';
        const categories = (data.categories||[]).map(c=>c.description).join(', ');
        const genres = (data.genres||[]).map(g=>g.description).join(', ');

        let flag = '';
        if(is_free) flag = '<span class="ok">ðŸ”¥ FREE</span>';
        else if(price !== null && parseFloat(price) <= 1.0) flag = '<span class="ok">ðŸ”¥ Cheap (<= $1)</span>';
        else flag = '<span class="muted">Normal price</span>';

        card.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="font-weight:700">${escapeHtml(title)}</div>
              <div class="muted">AppID: ${id} â€¢ ${genres?genres+' â€¢ ':''}${categories}</div>
            </div>
            <div style="text-align:right">
              <div class="price">${is_free?'<span class="ok">FREE</span>':(price?('$'+price+' '+currency):'<span class="muted">N/A</span>')}</div>
              <div style="font-size:12px">${flag}</div>
            </div>
          </div>
          <div style="margin-top:8px" class="muted">${data.short_description ? truncate(data.short_description,140) : ''}</div>
        `;

      }catch(err){
        card.innerHTML = '<div class="bad">Error fetching '+id+': '+escapeHtml(err.message||String(err))+'</div>';
      }
    }
  });

  function parseAppId(s){
    // If it's a number, return it. If it's a Steam URL, extract /app/ID/
    const num = s.match(/^\d+$/);
    if(num) return num[0];
    const m = s.match(/steampowered\.com\/app\/(\d+)/i);
    if(m) return m[1];
    return null;
  }
  function escapeHtml(t){return (t+'').replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));}
  function truncate(s,n){if(!s) return ''; return s.length>n? s.slice(0,n-1)+'â€¦':s}
</script>
<!-- START: Enhanced Steam Saver script -->
<script>
(async () => {
  // ---------- CONFIG ----------
  // agar Cloudflare Worker yoki boshqa proxy ishlatayotgan bo'lsang shu URLni qo'y:
  // const proxyBase = 'https://your-worker.example.workers.dev/proxy?u=';
  const proxyBase = ''; // agar CORS muammosi yo'q bo'lsa bo'sh qoldir

  const ratesAPI = 'https://api.exchangerate.host/latest?base=USD'; // conversion
  let rates = { UZS: 0 };

  // ---------- DOM refs ----------
  const inputArea = document.getElementById('appInput') || document.querySelector('#app-input') || null;
  const checkBtn = document.getElementById('checkBtn') || document.querySelector('#check-btn') || null;
  const resultsDiv = document.getElementById('results') || document.querySelector('#results') || null;
  const currencyToggle = document.getElementById('currencyToggle') || null;
  const favoritesBtn = document.getElementById('showFavs') || null;

  // fallback: create minimal UI if not present
  function ensureUI() {
    if (!inputArea) {
      const container = document.createElement('div');
      container.innerHTML = `
        <textarea id="appInput" rows="3" style="width:100%" placeholder="Paste AppIDs or Store URLs, one per line"></textarea>
        <div style="margin:8px 0">
          <button id="checkBtn">Check</button>
          <button id="showFavs">Favorites</button>
          <label style="margin-left:12px"><input type="checkbox" id="currencyToggle"> Show in UZS</label>
        </div>
        <div id="results"></div>
      `;
      document.body.prepend(container);
    }
  }
  ensureUI();

  // re-get refs if created
  const _input = document.getElementById('appInput');
  const _check = document.getElementById('checkBtn');
  const _results = document.getElementById('results');
  const _currency = document.getElementById('currencyToggle');
  const _favBtn = document.getElementById('showFavs');

  // ---------- Helpers ----------
  function parseLines(text){
    return text.split('\n').map(l => l.trim()).filter(Boolean).map(l=>{
      // if it's a url like https://store.steampowered.com/app/570/...
      const m = l.match(/\/app\/(\d+)/);
      if(m) return m[1];
      // if it is numeric appid
      if(/^\d+$/.test(l)) return l;
      // maybe it's store link with appid param
      const m2 = l.match(/appids=(\d+)/);
      if(m2) return m2[1];
      return null;
    }).filter(Boolean);
  }

  function renderGames(list, showUZS=false){
    _results.innerHTML = '';
    if(!list.length) { _results.innerHTML = '<p>No results</p>'; return; }
    list.forEach(g=>{
      const card = document.createElement('div');
      card.style = "border:1px solid #333;padding:10px;margin:8px 0;border-radius:6px;display:flex;gap:12px;align-items:flex-start";
      const img = document.createElement('img'); img.src = g.header_image || ''; img.width = 120;
      const meta = document.createElement('div'); meta.style = "flex:1";
      const title = document.createElement('h3'); title.textContent = g.name;
      const desc = document.createElement('div'); desc.innerHTML = (g.short_description || '').slice(0,200) + (g.short_description && g.short_description.length>200 ? '...' : '');
      let priceText = 'N/A';
      if(g.is_free) priceText = '<strong style="color:green">FREE</strong>';
      else if(g.price_overview) {
        const usd = (g.price_overview.final/100).toFixed(2);
        priceText = `$${usd}`;
        if(showUZS && rates.UZS) {
          const uzs = Math.round(parseFloat(usd) * rates.UZS);
          priceText += ` (~${uzs} UZS)`;
        }
      }
      const priceDiv = document.createElement('div'); priceDiv.innerHTML = `<div>Price: ${priceText}</div>`;
      const controls = document.createElement('div');
      const saveBtn = document.createElement('button');
      saveBtn.textContent = isFavorite(g.steam_appid) ? 'Unsave' : 'Save';
      saveBtn.onclick = () => { toggleFavorite(g); saveBtn.textContent = isFavorite(g.steam_appid) ? 'Unsave' : 'Save'; };
      controls.appendChild(saveBtn);
      meta.appendChild(title); meta.appendChild(priceDiv); meta.appendChild(desc); meta.appendChild(controls);
      card.appendChild(img); card.appendChild(meta);
      _results.appendChild(card);
    });
  }

  // ---------- Favorites (localStorage) ----------
  const FAV_KEY = 'steam_saver_favs_v1';
  function getFavs(){ try { return JSON.parse(localStorage.getItem(FAV_KEY)||'[]'); } catch(e){ return []; } }
  function saveFavs(a){ localStorage.setItem(FAV_KEY, JSON.stringify(a)); }
  function isFavorite(appid){ return getFavs().includes(String(appid)); }
  function toggleFavorite(game){
    const favs = getFavs();
    const id = String(game.steam_appid || game.appid || game.appid_raw || '');
    const idx = favs.indexOf(id);
    if(idx>=0) favs.splice(idx,1); else favs.push(id);
    saveFavs(favs);
    alert(idx>=0 ? 'Removed from favorites' : 'Saved to favorites');
  }

  // ---------- Fetch conversion rates ----------
  async function getRates(){
    try {
      const r = await fetch(ratesAPI);
      const j = await r.json();
      if(j && j.rates && j.rates.UZS) rates.UZS = j.rates.UZS;
    } catch(e){ console.warn('Rate fetch failed', e); }
  }

  // ---------- Fetch game data ----------
  async function fetchAppDetails(appid){
    try {
      const url = `https://store.steampowered.com/api/appdetails?appids=${appid}&cc=us&l=en`;
      const full = proxyBase ? proxyBase + encodeURIComponent(url) : url;
      const res = await fetch(full);
      if(!res.ok) return null;
      const j = await res.json();
      if(!j || !j[appid] || !j[appid].success) return null;
      const d = j[appid].data;
      d.steam_appid = appid;
      return d;
    } catch(e){ console.warn('fetch error', e); return null; }
  }

  // ---------- Main worker ----------
  async function checkAndRender(){
    const txt = (_input.value || '');
    const ids = parseLines(txt);
    if(!ids.length) { _results.innerHTML = '<p>No AppIDs provided</p>'; return; }
    _results.innerHTML = '<p>Loading...</p>';
    await getRates(); // try fetch rates
    const promises = ids.map(id => fetchAppDetails(id));
    const results = await Promise.all(promises);
    const cleaned = results.filter(Boolean);
    renderGames(cleaned, _currency && _currency.checked);
  }

  // ---------- Favorites view ----------
  async function showFavorites(){
    const favs = getFavs();
    if(!favs.length){ alert('No favorites yet'); return; }
    _results.innerHTML = '<p>Loading favorites...</p>';
    await getRates();
    const promises = favs.map(id => fetchAppDetails(id));
    const results = (await Promise.all(promises)).filter(Boolean);
    renderGames(results, _currency && _currency.checked);
  }

  // ---------- Event bindings ----------
  _check.addEventListener('click', e => { checkAndRender(); });
  if(_favBtn) _favBtn.addEventListener('click', e => showFavorites());
  if(_currency) _currency.addEventListener('change', e => { /* re-render if results exist: simple approach: re-check */ checkAndRender(); });

  // Optional: support Enter+Ctrl to check
  _input.addEventListener('keydown', e=> { if(e.key==='Enter' && (e.ctrlKey||e.metaKey)) { e.preventDefault(); checkAndRender(); } });

  // Auto-load favorites on start? (optional)
  // if(getFavs().length) showFavorites();

})();
</script>
<!-- END: Enhanced Steam Saver script -->

</body>
</html>
"<!-- rebuild $(date) -->" 
